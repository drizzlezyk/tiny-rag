# Tiny RAG

## 1.简介

准备实现一个很小很小的RAG系统；

技术路线：

- 初步计划：
  - 将wiki、baike 特定的文本进行向量化后，存储在离线向量数据库中；
  - 在线检索离线数据库；
  - 将检索结果重排后，送到llm，构造prompt，llm输出结果

拟采用技术：

- 文档解析：支持 txt, markdown, pdf, word, ppt，图像等向量化
- 文档embedding：主要使用bge，同时有在线zhipu，openai embedding
- 图像embedding: 使用 clip-vit 进行图像embedding
- 句子切分：支持模型和规则切分
  - 模型切分： 采取的文档语义分割模型为 nlp_bert_document-segmentation_chinese-base， 论文见https://arxiv.org/abs/2107.09278
  - 规则切分
- llm：主要支持qwen2本地调用，同时支持市面api
- 向量数据库： 使用 faiss 向量数据库
- 召回：实现多路召回
  - 向量召回：将句子 bge 模型编码后，使用 faiss 数据库召回 top-n
  - bm25召回：使用 bm25 算法关键字召回
- 重排： 结合多路召回的结果，使用 bge-ranker 模型进行重排

## 2.项目文件简介

具体如下所示：

```shell
├─data                  # 存放原始数据和向量数据库文件夹
│  ├─db                 ## 缓存数据库文件 
│  │  ├─bm_corpus       ### bm25 召回缓存数据
│  │  └─faiss_idx       ### 向量召回缓存数据
│  ├─parser_test
│  └─raw_data           ## 原始数据
├─doc                   # 相关文档
├─models                # 模型存放文件夹
│  ├─bge-reranker-base
│  ├─bge-small-zh-v1.5
│  ├─clip-ViT-B-32
│  └─nlp_bert_document-segmentation_chinese-base
├─script                # 执行脚本文件
├─test                  # 测试文件
└─tinyrag               # tinyrag
    ├─embedding         ## embedding
    ├─llm               ## llm
    ├─parser            ## 文档解析
    └─searcher          ## 根据query搜索相关文档
       ├─bm25_recall    ### bm25召回
       ├─emb_recall     ### 向量召回
       └─reranker       ### 重排

```


一些效果：

```shell
prompt: 请根据可参考的上下文来修正问题的回答；输出中文，直接输出文字，不要有引号，输出字数应在127字左右。

##可参考的上下文

北京及沈阳的明清皇家宫殿，或简称为明清故宫，是联合国教科文组织所登录的一项中国的世界文化遗产。登录的范围包括北京故宫博物院（紫禁城）及2004年追加的沈阳故宫等两个建筑群 。而另一个世界遗产则是明清皇家陵寝。
概要
1987年，北京故宫（紫禁城）被登录为世界文化遗产。紫禁城是世界现存最大的皇宫，为明清两朝24个皇帝所居住、办公的宫殿。由明成祖朱棣于1406年下旨修建，至1420年基本完成。     
2004年，沈阳故宫作为北京故宫的扩展项目被联合国教科文组织列为世界文化遗产。沈阳故宫是后金及满清初期，努尔哈赤及皇太极两名皇帝的宫殿，顺治帝在此继位，同时也是满清的离宫 之一。
两京，亦称两都，可以指：
* 两个具首都地位的京师，但只有行在具实际首都地位
 * 西周：首都镐京和东都洛邑
 * 西汉：首都长安和东都洛阳
 * 东汉/魏朝/西晋：首都洛阳和西京长安
 * 隋朝：首都长安和东都洛阳
 * 唐朝：首都长安和东都洛阳
 * 武周：神都（首都）洛阳和西京长安
 * 北宋：东京（首都）汴梁和西京洛阳
 * 南宋：行在（首都）临安和陪都建康
 * 元朝：元上都开平（夏季时的首都）和元大都北京（首都）
 * 明朝：北京（首都）顺天府和南京（陪都）应天府
 * 清朝：北京（首都）和沈阳（留都）
 * 大陆时期：首都南京和陪都重庆
* 政治首都和经济首都，即首都为政府所在地，但经济中心并非位于首都
 * ：政治首都北京市和经济首都直辖市上海市
 * ：政治首都华盛顿哥伦比亚特区（Washington District of Colombia）和经济首都纽约市


## 提出的问题
请介绍一下北京

## 问题的回答
北京是中国的首都，也是中国历史最悠久、人口最多的城市之一。作为中国历史文化名城，北京拥有丰富的历史文化底蕴和独具特色的自然风光，包括紫禁城、长城、颐和园等。同时，北京 还是中国重要的交通枢纽和经济中心，拥有众多知名企业和品牌，是全球乃至全球最大的城市之一。

修正的回答:
北京是中国著名的旅游胜地之一，拥有众多历史文化和名人。故宫是明清宫廷的完整宫殿，曾经为明清两朝扩建，如今正以三千多平方米的建筑面积开始规模改造。东京古都有较高的学术水准，同时也是中国古代皇宫的重要组成部分。北京的文化底蕴深厚，既是明清皇家御厂的所在地，也是中国古老建筑、园林艺术的典范。
```

